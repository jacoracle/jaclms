<div class="main-container-br">
    <div class="window-br">

      <!-- Window Header -->
      <div class="window-br-header">
        <div class="row-br-header">
          <div class="header-breadcrumbs">
            <div class="logo-home" routerLink="/"><i class="icon ni-nimbus"></i></div>
            <h4 routerLink="/learning-home" class="hb-title hbt-disabled" jhiTranslate="constructorApp.path.home.titleBread">/ Creador de Programas </h4>
            <h4 class="hb-title" jhiTranslate="constructorApp.path.home.titleConfgProgram">/ Configurar Programa </h4>
          </div>
          <div class="alert-path alert-nimbus-window">
              <jhi-alert-error></jhi-alert-error>
          </div>
        </div>
      </div>

      <!-- Window topbar -->
      <div class="window-br-body-topbar-group">
        <div class="line-gradient lg-step3"></div>
      </div>

        <div class="window-br-body-full">
            <div class="container-path-hierarchical" [ngSwitch]="isAuthenticated()">

                <div class="window-path-hierarchical-body">
                    <div class="hierarchical-bar">
                      <div class="hb-header">

                      </div>
                      <div class="hb-body">
                        <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" cdkDropList
                            [cdkDropListData]="dataSource.data" #treePath="cdkDropList"
                            (cdkDropListDropped)="dropOrder($event)">
                            <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding cdkDrag [cdkDragData]="node">
                                <button mat-icon-button disabled></button>
                                {{node.nombre}}
                            </mat-tree-node>

                            <mat-tree-node *matTreeNodeDef="let node; when: hasNoContent" matTreeNodePadding>
                                <button mat-icon-button disabled></button>
                                <mat-form-field>
                                    <mat-label>Nuevo Nodo</mat-label>
                                    <input matInput #itemValue placeholder="Nivel X ...">
                                </mat-form-field>
                                <button mat-button (click)="saveNode(node, itemValue.value)">Save</button>
                            </mat-tree-node>

                            <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding cdkDrag>
                                <button *ngIf="!isGroup(node)" mat-icon-button [attr.aria-label]="'toggle ' + node.filename" matTreeNodeToggle>
                                    <mat-icon>
                                        {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                                    </mat-icon>
                                </button>
                                <button *ngIf="isGroup(node)" mat-icon-button>
                                    <mat-icon style="color: #2ede9a;">book</mat-icon>
                                </button>
                                {{node.nombre}}
                                <!-- <button mat-icon-button (click)="addNewItem(node)">
                                    <mat-icon>add</mat-icon>
                                </button> -->
                                <button mat-icon-button [matMenuTriggerFor]="menu">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-progress-bar *ngIf="node.isLoading" mode="indeterminate"
                                    class="example-tree-progress-bar">
                                </mat-progress-bar>
                                <mat-menu #menu="matMenu">
                                    <button *ngIf="getLevel(node) === 0 && !isGroup(node)" mat-menu-item (click)="addRootLevel(node)">
                                        <!-- <mat-icon>class</mat-icon> -->
                                        <!-- <mat-icon>add_circle</mat-icon> -->
                                        <mat-icon>topic</mat-icon>
                                        Add Node
                                    </button>
                                    <button *ngIf="getLevel(node) === 0 && !isGroup(node)" mat-menu-item (click)="editNodeName(node)">
                                        <!-- <mat-icon>topic</mat-icon> -->
                                        <mat-icon>edit</mat-icon>
                                        Edit Node name
                                    </button>
                                    <button *ngIf="!isGroup(node)" mat-menu-item (click)="removeItem(node)">
                                        <mat-icon>delete_sweep</mat-icon>
                                        Delete Node
                                    </button>
                                    <!-- <hr> -->
                                    <button *ngIf="getLevel(node) < 2 && !isGroup(node)" mat-menu-item (click)="addNewItem(node)">
                                        <!-- <mat-icon>add_circle</mat-icon> -->
                                        <mat-icon>snippet_folder</mat-icon>
                                        Add child node
                                    </button>
                                    <button *ngIf="getLevel(node) > 0 && getLevel(node) < 3 && !isGroup(node)" mat-menu-item (click)="editNodeName(node)">
                                        <!-- <mat-icon>topic</mat-icon> -->
                                        <mat-icon>topic</mat-icon>
                                        Edit Child node name
                                    </button>
                                    <button *ngIf="getLevel(node) > 0 && getLevel(node) <= 3 && isGroup(node)" mat-menu-item (click)="removeGroup(node)">
                                        <mat-icon>delete_sweep</mat-icon>
                                        Delete group node
                                    </button>
                                </mat-menu>
                            </mat-tree-node>
                        </mat-tree>
                      </div>
                    </div>

                    <div class="sequences-section" cdkDropList [cdkDropListData]="sequenceList"
                        cdkDropListSortingDisabled [cdkDropListConnectedTo]="[treePath]"
                        (cdkDropListDropped)="dropOrder($event)">

                        <div class="ss-header">
                          <div class="br-tp-subtitle">
                            <h5 jhiTranslate="group.sequence.yourumas">Tus Agrupadores</h5>
                            <span>{{sequenceList.length}}</span>
                          </div>
                          <form name="learningPathForm" role="form" [formGroup]="learningPathForm" autocomplete="off"
                              class="form-uma-search">
                              <mat-form-field appearance="outline">
                                  <mat-label>Buscar</mat-label>
                                  <input type="text" placeholder="" matInput formControlName="searchGroup"
                                      [matAutocomplete]="searchGroup">
                                  <mat-autocomplete autoActiveFirstOption #searchGroup="matAutocomplete"
                                      [displayWith]="displayFn">
                                  </mat-autocomplete>
                              </mat-form-field>
                          </form>
                        </div>
                        <div class="ss-body">
                            <div class="grid-cards">
                                <div class="box-card" *ngFor="let groups of sequenceList;" cdkDrag
                                    [cdkDragData]="groups">
                                    <div class="row-content-card">
                                      <div class="group-cover-br-image"><span></span></div>
                                      <div class="course-desc-br-row">
                                        <span class="title-course-br"
                                            *ngIf="groups.titulo">{{groups.titulo.length > 30 ? groups.titulo.substring(0, 30) + "..." : groups.titulo}}</span>
                                        <span class="desc-course-br"
                                            *ngIf="groups.descripcion">{{groups.descripcion!.length > 28 ? groups.descripcion!.substring(0, 28) + "..." : groups.descripcion!}}</span>
                                      </div>
                                    </div>
                                    <div class="row-buttons-card">
                                      <!-- <div class="edit-course-br" [routerLink]="['/group-configuration', sec.id]">
                                          <i class="icon ni-edit icon-negative"></i>
                                      </div> -->
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- <p>{{ dataSource.data | json }}</p> -->
                    </div>

                </div>

            </div>

        </div>

        <!-- Footer -->
        <div class="window-br-footer">
            <button routerLink="/learning-home" matTooltip="Regresar al Home."
                class="secondary-btn">Cancelar</button>
            <button routerLink="/learning-home" class="main-btn create-btn">Terminar</button>
        </div>

    </div>
</div>
